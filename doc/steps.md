## Steps definition

This document describes the steps that can be used in our pipelines. A step is
the unit of transformation generated by a user interaction with the visual query
builder.

### `aggregate` step

Perform aggregations on one or several columns.

An aggreation step has the following strucure:

```javascript
{
   name: 'aggregate',
   on: ['column1', 'column2'],
   aggregations:  [
      {
          newcolumn: 'sum_value1'
          aggfunction: 'sum'
          column: 'value1',
      }
    // ...
  ]
}
```

### `custom` step

This step allows to define a custom query that can't be expressed using the
other existing steps.

```javascript
{
    name: 'custom',
    query: '$group: {_id: ...}',
}
```

### `delete` step

Delete a column.

```javascript
{
    name: 'delete',
    columns: ['my-column', 'some-other-column']
}
```

### `domain` step

This step is meant to select a specific domain (using MongoDB terminology).

```javascript
{
    name: 'domain',
    domain: 'my-domain'
}
```

### `fillna` step

Replace null values by a given value in a column.

```javascript
{
    name: 'fillna',
    column: "foo",
    value: "bar"
}
```

### `filter` step

Filter out lines that don't match a filter definition.

```javascript
{
    name: 'filter',
    column: 'my-column',
    value: 42
    operator: 'ne'
}
```

### `percentage` step

Compute the percentage of total, i.e. for every row the value in `column` divided
by the total as the sum of every values in `column`. The computation can be performed
by `group` if specified. The result can be either ouput inplace or in a `new_column` if specified

```javascript
{
name: 'percentage',
new_column: 'new_col', // optional
column: 'bar',
group: ['foo'] // optional
}
```

`operator` is optional, and defaults to `eq`. Allowed operators are `eq`, `ne`,
`gt`, `ge`, `lt`, `le`, `in`, `nin`.

`value` can be an arbitrary value (e.g a list when used with the `in` operator)

### `rename` step

Rename a column.,

```javascript
{
    name: 'filter',
    oldname: 'old-column-name',
    newname: 'new-column-name'
}
```

### `replace` step

Replace value in a column, and write resulting column inplace or in a new column.

A replace step has the following strucure:

```javascript
{
   name: 'replace',
   search_column: "column_1",
   new_column: "column_1", // if empty, inplace by default
   oldvalue: 'foo',
   newvalue: 'bar',
}
```

### `select` step

Select a column. The default is to keep every columns of the input domain. If
the `select` is used, it will only keep selected columns in the output.

```javascript
{
    name: 'select',
    columns: ['my-column', 'some-other-column']
}
```

### `sort` step

Sort values in one or several columns. Order can be either 'asc' or 'desc'.
When sorting on several columns, order of columns specified in `columns` matters,
and the `order` parameter must be of same length as `columns`. By default, if
`order` is not specified, it is considered as 'asc'.

```javascript
{
    name: 'sort',
    columns: ['foo', 'bar'],
    order: ['asc', 'desc']
}
```

### `top` step

Return top N rows by group if `groups` is specified, else over full dataset.

```javascript
{
  name: 'top',
  groups: ['foo'],
  rank_on: 'bar',
  sort: 'desc', // or 'asc'
  limit: 10
}
```
